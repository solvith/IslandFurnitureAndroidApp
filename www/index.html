<html>
    <!-- NFC INTENT NOT PERFECT 
    
    -->

    <head>
        <title>Island Furniture App</title>
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="css/af.ui.css" />
        <link rel="stylesheet" type="text/css" href="css/icons.css" />
		<script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" charset="utf-8" src="ui/appframework.ui.min.js"></script>
		<script type="text/javascript" src="js/NFCINDEX.js"></script>

        <script type="text/javascript">

            $.ui.useOSThemes = false;

            if (localStorage.getItem('co_id') == null && window.location.hash != '#settings') {
                window.location = 'countryselect.html';
            }else{
			}

        </script>   
    </head>
    <body> 



        <div id="afui">

            <div id="header">
                <!-- header -->
                <header>
                    <a id='menubadge' onclick='af.ui.toggleSideMenu()' class='menuButton'></a>
                </header>
            </div>

            <!-- content-->
            <div id="content">
                <!-- side nav -->
                <nav>
                    <ul class="list">
                        <li  class="divider">By Category</li>

                        <li ><a href=""  onclick="location.href = 'catalogue.html'">Catalog</a></li>
                        <li ><a href="" onclick="location.href='shoppingList.html'">Shopping List</a></li>
                        <li ><a href="#login">Membership</a></li>
                        <li ><a href="#locate" onclick="javascript:localStorage.setItem('predefined_CO',localStorage.getItem('co_code'));window.location='countryselect.html'">Locate</a></li>
                    </ul>
                </nav>



                <!-- Login -->
                <div class="panel" data-title="Login" id="login">
                    <br/>

                    <script type="text/javascript">
                        function login() {
                            localStorage.setItem("email", $("#email").val());
                            localStorage.setItem("pass", $("#pass").val());

                    //remember to change to ws
                            requesturl = ip_add+ "rest/auth/memberlogin?email=" + $("#email").val() + "&password=" + $("#pass").val();
                            $.get(requesturl, function(data) {
                                if (data == 'FAIL') {
                                    $("#loginmsg").html("Login Failed !");
                                } else {
                                    localStorage.setItem("cust_id", data);
                                    window.location = 'index.html?logout#login';
                                }
                            });
                        }

                        function logout() {
                            localStorage.setItem("pass", "");	
                            localStorage.setItem("cust_id", "");
                            localStorage.setItem("point", "");
                            localStorage.setItem("tier", "");
                            localStorage.setItem("name", "");
                            window.location = 'index.html?login#login';
                        }


                        $(document).ready(function() {
                            $("#email").val(localStorage.getItem("email"));
                            $("#pass").val(localStorage.getItem("pass"));

                    //Refresh Points
                            if (localStorage.getItem("cust_id") != null && localStorage.getItem("cust_id") != "") {
                                requesturl = ip_add+ "rest/cs/memberlogin?custid=" + localStorage.getItem("cust_id");
                                console.log(requesturl);
                                $.get(requesturl, function(data) {
                                    dataj = JSON.parse(data);
                                    localStorage.setItem("point", dataj["point"]);
                                    localStorage.setItem("tier", dataj["tier"]);
                                    localStorage.setItem("name", dataj["name"]);
                                    updatemember();

                                });

                                updatemember();

                                $("#logout").show();
                                $("#login_screen").hide();

                            } else {
                                $("#logout").hide();
                                $("#login_screen").show();
                            }

                        });

                        function updatemember() {
                            if (localStorage.getItem("name") != "" && localStorage.getItem("name") != null) {
                                $("#member_name").html(localStorage.getItem("name"));
                                $("#Tier").html(localStorage.getItem("tier"));
                                $("#cpoint").html(localStorage.getItem("point"));
                            }
                        }
                    </script>
                    <div id="logout" style="display:hidden">
                        <ul class="list">
                            <li><i class="fa fa-users"></i>&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;font-size:1.2em">Name:</span> <span id="member_name"></span></li>
                            <li><i class="fa fa-key"></i>&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;font-size:1.2em">Membership Tier:</span> <span id="Tier"></span></li>
                            <li><i class="fa fa-money"></i>&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;font-size:1.2em">Current Points:</span> <span id="cpoint"></span></li>
                            <br/>
                            <div style="text-align:center">
                                <a class="button red" onclick="javascript:logout();" style="width:150px;">Logout</a>
                            </div>
                        </ul>
                        <form id="">
                        </form>
                    </div>

                    <form id="login_screen" style="display:hidden;">
                        Login Now for exciting services that islandfurniture app can offer !
                        <br/>
                        <label for="email">Email</label><input id="email" type="text" placeholder="UserName">
                        <label for="pass">Password</label><input id="pass" type="password" placeholder="Password">
                        <div id="loginmsg" style="color:red;text-align:center">
                        </div>
                        <div class="button-grouped flex">
                            <a class="button orange">Register</a>
                            <a class="button green" onclick="javascript:login();">Login Now</a>
                            <a class="button red">Forget Password</a>
                        </div>
                    </form>

                </div>


                <!-- Settings -->
                <div class="panel" data-title="Settings" id="settings" >
                    <form>
                        <br/>

                        <br/>
                        <ul class='list'>
                            <li>
                                <label for="IP_ADD">IP Address: </label>
                                <input style="max-width:400px;" id="IP_ADD" type="text" placeholder="SERVER IP ADDRESS" value="https://172.28.191.103/ws/" onchange="javascript:update_ip(this.value)">
                            </li>
                            <li>
                                <label for="">Preferred Store: </label>
                                <script>
                                    $(document).ready(function() {
                                        $("#pref_store").html("&nbsp;" + localStorage.getItem('store'));
                                    })
                                </script>
                                <div id="pref_store" style="display:inline;width:150px">
                                </div>

                                <a href="" onclick="window.location = 'countryselect.html'" style="color:green">(Change)</a>
                            </li>
                        </ul>


                        <br/>
                        <div style="text-align:center">
                            <a class="button green" onclick="javascript:update_ip($('#IP_ADD').val());
                    window.location = 'index.html';">Save Settings</a>
                        </div>

                        <script type="text/javascript">
                            if (localStorage.getItem("IPADDRESS") != null)
                            {
                                $("#IP_ADD").val(ip_add);
                            }

                            function update_ip(value) {
                                localStorage.setItem("IPADDRESS", value);
                            }

                            $(document).ready(function() {
                                ip_add = localStorage.getItem("IPADDRESS");

                                if (ip_add != "") {
                                    $("#IP_ADD").val(ip_add);
                                }
                            });

                            var ip_add = "";
                            function get_ip() {
                                ip_add = localStorage.getItem("IPADDRESS");

                            }

                            get_ip();

                        </script>

                        <br/>
                    </form>

                </div>

                <!-- side banner-->
                <div class="panel" data-title="Island Furniture" selected="true" id="home">
                    <ul class="list">
                        <li><a class="icon heart" href=""  onclick="location.href = 'catalogue.html'">Product Catalog</a></li>
						
                        <li><a class="icon star" href="" onclick="location.href='shoppingList.html'">Shopping List</a></li>
                        <li><a class="icon key" href="#login">Membership</a></li>
                        <li><a class="icon location" href="javascript:void" onclick="localStorage.setItem('predefined_CO',localStorage.getItem('co_code'));window.location='countryselect.html'">Locate</a></li>
                        <li><a class="icon settings" href="#settings">Settings</a></li>
                        <li><a class="icon settings" href="" onclick="javascript:location.href = 'NFC.html'">Developer</a></li>
                    </ul>


                </div>
            </div>

            <!-- footer --> 
            <div id="navbar">
                <a class="icon home" href="#home">Home</a>
                <a class="icon tag" href="javascript:void" onclick="window.location = 'catalogue.html'">Catalog</a>
                <a class="icon star" href="javascript:void" onclick="window.location = 'shoppingList.html'">Shopping List</a>
                <a class="icon settings" href="#login">Membership</a>
                <a class="icon location" href="javascript:void" onclick="localStorage.setItem('predefined_CO',localStorage.getItem('co_code'));window.location='countryselect.html'">Locate</a>
            </div>


        </div>
    </body>
	        <script type="text/javascript">
            app.initialize();
        </script>
</html>
