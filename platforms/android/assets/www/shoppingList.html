<html>
    <!-- NFC INTENT NOT PERFECT 
    
    -->

    <head>
        <title>Island Furniture App</title>
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="css/af.ui.css" />
        <link rel="stylesheet" type="text/css" href="css/icons.css" />
        <script type="text/javascript" charset="utf-8" src="ui/appframework.ui.min.js"></script> 
        <script type="text/javascript" src="cordova.js"></script>
				<script type="text/javascript" src="js/NFCINDEX.js"></script>
        <style type="text/css">
            .label{
                width:150px;
            }
        </style>

        <script type="text/javascript">$.ui.useOSThemes = false;
            ip_add = localStorage.getItem("IPADDRESS");
            if (ip_add == null) {
                location.href = "index.html#settings";
            }
            
			//Require Login
			
			 if (localStorage.getItem("cust_id") == null || localStorage.getItem("cust_id") == "")
			 {
			 window.location='index.html#login';
			 }
			 
			 //Require Store
			 
			 if (localStorage.getItem('store')==null){
			 window.location='countryselect.html';
			 }
			 
			
			$(document).ready(function(){
			requesturl="http://"+ip_add+"/rest/cs/shoplist?cust_id="+localStorage.getItem('cust_id')+"&store_id="+localStorage.getItem('store_id');
			
			if (localStorage.getItem("NFC")!=null && localStorage.getItem("NFC")!="")
			{
			requesturlnfc="http://"+ip_add+"/rest/cs/additembynfc?cust_id="+localStorage.getItem('cust_id')+"&store_id="+localStorage.getItem('store_id')+"&NFC_TAG="+localStorage.getItem("NFC");
			localStorage.removeItem("NFC");
			$.get(requesturlnfc,function(datan){
			$(document.body).popup({title:"Information",message:datan, doneCallback: function () {
    window.location='shoppingList.html';
    }});
			
			});
			}
			
			$.get(requesturl,function(data){
			dataj=JSON.parse(data);
			
			if (dataj['details'].length==0){
						$("<li>Opps Nothing in here ! Add something from Shopping list now !</li>").appendTo('#slist');

			}

			for (i=0;i<dataj['details'].length;i++)
			{
			newrow=$("#template").clone().css('display','').attr('id','row_'+i);
			if (dataj['details'][i]['PromoTxt']==""){
			newrow.find('label.name').html(dataj['details'][i]['fm'] +"--"+dataj['details'][i]['uprice']);
			}else{
			newrow.find('label.name').html(dataj['details'][i]['fm'] +"--<span style='text-decoration: line-through;'>"+dataj['details'][i]['oprice']+"</span>&nbsp;Promo:"+dataj['details'][i]['uprice']);
			}
			
			newrow.find('label.subtotal').html('Price: $'+dataj['details'][i]['price']);
			newrow.find('input').val(dataj['details'][i]['qty']);
			newrow.find('.green').bind('click',
			
			
			(function(ii,oqty,fid){return function(){
			val=$("#row_"+ii+" input").val()-oqty;
			requesturl="http://"+ip_add+"rest/cs/additemtoshoplist?cust_id="+localStorage.getItem('cust_id')+"&store_id="+localStorage.getItem('store_id')+"&fm_id="+fid+"&qty="+val;
		$(document.body).popup({title:"Updating",message:"Please Wait"});
		
		$.get(requesturl,function(data){
		window.location='shoppingList.html';
		});
			
			}})(i,dataj['details'][i]['qty'],dataj['details'][i]['fid'])
			
			);
			
						newrow.find('.red').bind('click',
			
			
			(function(sldid){return function(){
			requesturl="http://"+ip_add+"rest/cs/deleteitemfromshoplist?detailID="+sldid;
		$(document.body).popup({title:"Updating",message:"Please Wait"});
		
		$.get(requesturl,function(data){
		window.location='shoppingList.html';
		});
			
			}})(dataj['details'][i]['delete_id'])
			
			);
			
			
			
			//deleteitemfromshoplist
			
			
			
			newrow.appendTo('#slist');
			}
			
			
			$("<li class='divider' id='total_price' style='text-align:right;font-size:1.5em'>TOTAL PRICE: $"+dataj['totalprice']+"</li>").appendTo('#slist');

			})

			})
			
			
        </script>   
    </head>
    <body> 



        <div id="afui">

            <div id="header">
                <!-- header -->
                <header>
                </header>
            </div>

            <!-- content-->
            <div id="content">
                <!-- side nav -->
                <div class="panel" data-title="Shopping List" id="slist_div">
                    <ul class="list" id="slist">
					<li class='divider'>
										<script>document.write("Shopping List@"+localStorage.getItem('store'));</script>
										</li>
					<li id="template" style="display:none; text-align:center;height:150px">
					<label class='name' style='font-size:1.2em'>Item Name</label>
					<input id="" type="text" style="max-width:100px" placeholder="Qty">
					<br/>
			<label class='subtotal' style='font-size:1.2em;'></label>
					
<div class="button-grouped">
					  <a class="button green" class='green'  onclick="">Modify</a>
					  <a class="button red" class='red'   onclick="">Remove</a>
					  </div>
					  </li>
					  

					  
                    </ul>
                </div>
            </div>




            <!-- footer --> 
            <div id="navbar">
                <a class="icon home" href="javascript:void" onclick="window.location='index.html'">Home</a>
				                <a class="icon tag" href="javascript:void" onclick="window.location = 'catalogue.html'">Catalog</a>
            </div>
        </div>
	        <script type="text/javascript">
            app.initialize();
        </script>
    </body>
</html>
